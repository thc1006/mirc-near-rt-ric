<!-- Copyright 2024 The O-RAN Near-RT RIC Authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. -->

<div class="yang-tree-browser">
  <!-- Control Panel -->
  <div class="control-panel">
    <div class="controls-row">
      <!-- Search Controls -->
      <div class="search-group">
        <label for="search-input" class="control-label">
          <i class="fas fa-search"></i> Search
        </label>
        <input 
          id="search-input"
          type="text" 
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
          placeholder="Search nodes, paths, or descriptions..."
          class="search-input"
        >
        <button 
          class="clear-search-btn"
          (click)="searchTerm = ''; onSearch()"
          [disabled]="!searchTerm"
          title="Clear search">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Filter Controls -->
      <div class="filter-group">
        <label for="filter-select" class="control-label">
          <i class="fas fa-filter"></i> Filter
        </label>
        <select 
          id="filter-select"
          [(ngModel)]="filterType"
          (change)="onFilterChange()"
          class="filter-select">
          <option *ngFor="let type of getNodeTypes()" [value]="type">
            {{ type | titlecase }}
          </option>
        </select>
      </div>

      <!-- Tree Controls -->
      <div class="tree-controls">
        <button 
          class="control-btn expand-btn"
          (click)="expandAll()"
          title="Expand all nodes">
          <i class="fas fa-expand-arrows-alt"></i>
          Expand All
        </button>
        <button 
          class="control-btn collapse-btn"
          (click)="collapseAll()"
          title="Collapse all nodes">
          <i class="fas fa-compress-arrows-alt"></i>
          Collapse All
        </button>
        <button 
          class="control-btn center-btn"
          (click)="centerTree()"
          title="Center tree view">
          <i class="fas fa-crosshairs"></i>
          Center
        </button>
      </div>

      <!-- View Options -->
      <div class="view-options">
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="showMetadata"
            class="checkbox-input">
          <span class="checkbox-custom"></span>
          Show Metadata
        </label>
      </div>
    </div>

    <!-- Statistics Row -->
    <div class="statistics-row">
      <div class="stat-item">
        <i class="fas fa-sitemap"></i>
        <span class="stat-label">Total Nodes:</span>
        <span class="stat-value">{{ expandedNodes.size }}</span>
      </div>
      <div class="stat-item">
        <i class="fas fa-eye"></i>
        <span class="stat-label">Expanded:</span>
        <span class="stat-value">{{ expandedNodes.size }}</span>
      </div>
      <div class="stat-item">
        <i class="fas fa-search"></i>
        <span class="stat-label">Search Term:</span>
        <span class="stat-value">{{ searchTerm || 'None' }}</span>
      </div>
    </div>
  </div>

  <!-- Tree Visualization Container -->
  <div class="tree-container-wrapper">
    <div class="tree-header">
      <h3 class="tree-title">
        <i class="fas fa-project-diagram"></i>
        O-RAN YANG Model Browser
      </h3>
      <div class="tree-subtitle">
        Interactive hierarchical view of YANG data models and runtime values
      </div>
    </div>

    <!-- Help Panel (Collapsible) -->
    <div class="help-panel" [class.collapsed]="!showMetadata">
      <div class="help-header" (click)="showMetadata = !showMetadata">
        <i class="fas fa-question-circle"></i>
        <span>Navigation Help</span>
        <i class="fas" [class.fa-chevron-down]="showMetadata" [class.fa-chevron-up]="!showMetadata"></i>
      </div>
      <div class="help-content" *ngIf="showMetadata">
        <div class="help-section">
          <h4><i class="fas fa-mouse-pointer"></i> Interaction</h4>
          <ul>
            <li><strong>Click nodes</strong> to expand/collapse children</li>
            <li><strong>Drag</strong> to pan the tree view</li>
            <li><strong>Mouse wheel</strong> to zoom in/out</li>
            <li><strong>Hover nodes</strong> for detailed information</li>
          </ul>
        </div>
        <div class="help-section">
          <h4><i class="fas fa-palette"></i> Node Types</h4>
          <div class="node-legend">
            <div class="legend-item">
              <div class="legend-color container"></div>
              <span>Container</span>
            </div>
            <div class="legend-item">
              <div class="legend-color leaf"></div>
              <span>Leaf</span>
            </div>
            <div class="legend-item">
              <div class="legend-color list"></div>
              <span>List</span>
            </div>
            <div class="legend-item">
              <div class="legend-color leaf-list"></div>
              <span>Leaf-List</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Tree Visualization -->
    <div 
      #treeContainer 
      class="tree-container"
      [class.fullscreen]="!showMetadata">
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" *ngIf="!expandedNodes.size">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
      </div>
      <div class="loading-text">Loading YANG model data...</div>
    </div>
  </div>

  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-section">
      <i class="fas fa-info-circle"></i>
      <span>Tip: Click nodes to explore the hierarchy, use mouse wheel to zoom</span>
    </div>
    <div class="status-section">
      <i class="fas fa-clock"></i>
      <span>Last Updated: {{ new Date() | date:'medium' }}</span>
    </div>
  </div>
</div>