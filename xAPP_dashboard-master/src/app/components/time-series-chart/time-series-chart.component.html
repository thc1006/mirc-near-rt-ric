<!-- Copyright 2024 The O-RAN Near-RT RIC Authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. -->

<div class="time-series-chart">
  <!-- Control Panel -->
  <div class="chart-controls">
    <div class="controls-section">
      <!-- Chart Type Controls -->
      <div class="control-group">
        <label class="control-label">
          <i class="fas fa-chart-line"></i>
          Chart Type
        </label>
        <div class="button-group">
          <button 
            class="control-btn"
            [class.active]="chartType === 'line'"
            (click)="setChartType('line')"
            title="Line Chart">
            <i class="fas fa-chart-line"></i>
            Line
          </button>
          <button 
            class="control-btn"
            [class.active]="chartType === 'area'"
            (click)="setChartType('area')"
            title="Area Chart">
            <i class="fas fa-chart-area"></i>
            Area
          </button>
          <button 
            class="control-btn"
            [class.active]="chartType === 'scatter'"
            (click)="setChartType('scatter')"
            title="Scatter Plot">
            <i class="fas fa-braille"></i>
            Scatter
          </button>
        </div>
      </div>

      <!-- Time Range Controls -->
      <div class="control-group">
        <label class="control-label">
          <i class="fas fa-clock"></i>
          Time Range
        </label>
        <div class="button-group">
          <button 
            class="control-btn"
            [class.active]="timeRange === '1h'"
            (click)="setTimeRange('1h')">
            1H
          </button>
          <button 
            class="control-btn"
            [class.active]="timeRange === '6h'"
            (click)="setTimeRange('6h')">
            6H
          </button>
          <button 
            class="control-btn"
            [class.active]="timeRange === '24h'"
            (click)="setTimeRange('24h')">
            24H
          </button>
          <button 
            class="control-btn"
            [class.active]="timeRange === '7d'"
            (click)="setTimeRange('7d')">
            7D
          </button>
        </div>
      </div>

      <!-- Display Options -->
      <div class="control-group">
        <label class="control-label">
          <i class="fas fa-eye"></i>
          Display
        </label>
        <div class="toggle-group">
          <label class="toggle-label">
            <input 
              type="checkbox" 
              [(ngModel)]="showAnomalies"
              (change)="updateChartOptions()"
              class="toggle-input">
            <span class="toggle-slider"></span>
            Anomalies
          </label>
          <label class="toggle-label">
            <input 
              type="checkbox" 
              [(ngModel)]="showPredictions"
              (change)="updateChartOptions()"
              class="toggle-input">
            <span class="toggle-slider"></span>
            Predictions
          </label>
          <label class="toggle-label">
            <input 
              type="checkbox" 
              [(ngModel)]="autoRefresh"
              (change)="toggleAutoRefresh()"
              class="toggle-input">
            <span class="toggle-slider"></span>
            Auto Refresh
          </label>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="control-group">
        <label class="control-label">
          <i class="fas fa-tools"></i>
          Actions
        </label>
        <div class="action-buttons">
          <button 
            class="action-btn export-btn"
            (click)="exportChart()"
            title="Export Chart">
            <i class="fas fa-download"></i>
            Export
          </button>
          <button 
            class="action-btn clear-btn"
            (click)="clearData()"
            title="Clear Data">
            <i class="fas fa-trash"></i>
            Clear
          </button>
        </div>
      </div>
    </div>

    <!-- Metrics Selection -->
    <div class="metrics-section">
      <div class="metrics-header">
        <h4>
          <i class="fas fa-list-check"></i>
          Select Metrics
        </h4>
      </div>
      <div class="metrics-list">
        <div 
          *ngFor="let metric of metrics"
          class="metric-item"
          [class.enabled]="selectedMetrics.includes(metric.id)">
          <label class="metric-label">
            <input 
              type="checkbox"
              [checked]="selectedMetrics.includes(metric.id)"
              (change)="toggleMetric(metric.id)"
              class="metric-checkbox">
            <div class="metric-indicator" [style.background-color]="metric.color"></div>
            <span class="metric-name">{{ metric.name }}</span>
            <span class="metric-unit">({{ metric.unit }})</span>
          </label>
          <div class="metric-stats" *ngIf="metric.data.length > 0">
            <span class="stat-current">
              {{ metric.data[metric.data.length - 1]?.value | number:'1.1-1' }}{{ metric.unit }}
            </span>
            <span class="stat-points">
              {{ metric.data.length }} points
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics Panel -->
  <div class="statistics-panel">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-database"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.totalDataPoints | number }}</div>
          <div class="stat-label">Data Points</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.anomaliesDetected }}</div>
          <div class="stat-label">Anomalies</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-tachometer-alt"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.averageLatency | number:'1.1-1' }}ms</div>
          <div class="stat-label">Avg Latency</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-wifi"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.maxThroughput | number:'1.1-1' }}Mbps</div>
          <div class="stat-label">Max Throughput</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-sync-alt"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.lastUpdate | date:'HH:mm:ss' }}</div>
          <div class="stat-label">Last Update</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Chart Container -->
  <div class="chart-container-wrapper">
    <div class="chart-header">
      <h3 class="chart-title">
        <i class="fas fa-chart-line"></i>
        Real-Time O-RAN Metrics Dashboard
      </h3>
      <div class="chart-subtitle">
        {{ selectedMetrics.length }} metrics selected • 
        {{ timeRange.toUpperCase() }} time range • 
        {{ autoRefresh ? 'Auto refresh ON' : 'Auto refresh OFF' }}
      </div>
    </div>

    <!-- Chart Canvas -->
    <div 
      #chartContainer 
      class="chart-container"
      [class.dark-theme]="true">
    </div>

    <!-- Loading Indicator -->
    <div class="loading-indicator" *ngIf="statistics.totalDataPoints === 0">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
      </div>
      <div class="loading-text">Loading real-time data...</div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="selectedMetrics.length === 0 && statistics.totalDataPoints > 0">
      <div class="empty-icon">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="empty-title">No Metrics Selected</div>
      <div class="empty-message">
        Please select at least one metric from the control panel to view the chart.
      </div>
    </div>
  </div>

  <!-- Anomalies Panel -->
  <div class="anomalies-panel" *ngIf="showAnomalies && anomalies.length > 0">
    <div class="anomalies-header">
      <h4>
        <i class="fas fa-exclamation-triangle"></i>
        Recent Anomalies
        <span class="anomaly-count">{{ anomalies.length }}</span>
      </h4>
    </div>
    <div class="anomalies-list">
      <div 
        *ngFor="let anomaly of anomalies.slice(-10)" 
        class="anomaly-item"
        [class]="'severity-' + anomaly.severity">
        <div class="anomaly-time">
          {{ anomaly.timestamp | date:'HH:mm:ss' }}
        </div>
        <div class="anomaly-metric">
          {{ anomaly.metric }}
        </div>
        <div class="anomaly-value">
          {{ anomaly.value | number:'1.1-1' }}
        </div>
        <div class="anomaly-severity">
          <span class="severity-badge" [class]="'severity-' + anomaly.severity">
            {{ anomaly.severity | titlecase }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart Status Bar -->
  <div class="chart-status">
    <div class="status-left">
      <i class="fas fa-info-circle"></i>
      <span>Drag to zoom • Mouse wheel to pan • Click data points for details</span>
    </div>
    <div class="status-right">
      <span class="refresh-interval" *ngIf="autoRefresh">
        <i class="fas fa-clock"></i>
        Refresh: {{ refreshInterval }}s
      </span>
      <span class="data-quality">
        <i class="fas fa-signal"></i>
        Data Quality: 
        <span class="quality-good">Good</span>
      </span>
    </div>
  </div>
</div>